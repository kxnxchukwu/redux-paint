import express from "express";
import cors from "cors";
import bodyParser from "body-parser";
import lowdb from "lowdb";
import FileSync from "lowdb/adapters/FileSync";
import { nanoid } from "nanoid";

let db = lowdb(new FileSync<{ projects: Project[] }>("db.json"));

db.defaults({
  projects: [
    {
      id: nanoid(),
      name: "Test Project",
      image:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMwAAACZCAYAAABjYdW2AAAAAXNSR0IArs4c6QAAG9RJREFUeF7tnQu8lWP2x3+5Dwm5K5TLYPpTuTRyHSMhg4wubjOVe5pUqglNIcPwSZIJjaIwRsktdBEGlYYYaiZy10XuKk260OV/vuvst/Y5Z++z373P3m/nvHstnz6V87zP8z7reX89z1rrt9ZTa926devk4hpwDYTSQC0HTCg9eSPXgGnAAeMfgmsgCw04YLJQljd1DThg/BtwDWShAQdMFsrypq4BB4x/A66BLDTggMlCWd7UNeCA8W/ANZCFBhwwWSjLm7oGHDD+DbgGstCAAyYLZXlT14ADxr8B10AWGnDAZKEsb+oacMDU2G9glqS5ks6ssTOoiS/ugKlxq7ZW0kxJkyWtkrSXpE41bhY19YUdMDVq5QDLB5I+knSypM0lDZHURlK9GjWTmvqyDpgatXJvSfpcUktJWyTe/HVJX/rRLKJ1dMBEpOiqDwNYXpTUPbGzBD0ukfSKA6bqCg7VgwMmlJo2dqP3JY2TdK6kPcu9DID5ZwIwm27sF439+A6Yar/Eq0vslX9J2lHSL1K87feSRkg6TdKB1X42Nf0FHTDVfgXfLPGCzUvsIJuleNsfJT2fMPqbVPvZ1PQXdMBU+xW8Q9JvE+7jdC+LmxlxwBR6OR0whdZwlfofKQlX8kUZenHAVEnNWTzsgMlCWYVryge/XNKRkjZJDPOdpDGSrggxrAMmhJLy0sQBkxc1VrUTPni8YK0lNU50xt/3T2Polx/PAVPVFQj7vAMmrKYK2o4PfoGk+SW/LpT0TQJAv5O0fYiRHTAhlJSXJg6YvKhRWqRFWq7lqq/6OfTIBw9IGkiaIumwFEe0yrp1wOSg9JweccDkpLaKD3VSJ43SKK1TLqWq/yvpuRLay6UJuwX6CyzksF4vB0yeljFjNw6YjCoK16C7umuohmq1CDRmK4uTbBieHSrpUEktkjhjvsNkq9VCtHfA5Emrd+ku9VEffaNv9DP9LIdeMfKPl/SCZKDbNkHfJwaTSXyHyaShfP3cAZMnTb6sl9VGbXSADtCrejWHXgPAEHu5XBK8MCgxn4TId3HA5KDwnB5xwOSktooPfaSPdJyO05baUp/q0xx6BTDkudQtBxCYyMRkTpG0dZp+HTA5KDynRxwwOamt4kM/6kf9XD+3HwCezZSK91XZYJMkzSiJ7Pcv14jjGYDAzmkuqXaKThwweVrGjN04YDKqKHyDhmpoNswgDdJluiz8g9YyHWD42ZrE7vOOpH1SeM8cMFkqO+fmDpicVVfxQQDzrb41W2aksEWyEY5kfPjXpXkId/X/JN0l6XBJJyW1c8Bko+mqtHXAVEV75Z4dq7Fqp3bqqI5ZAubdRFELANEvwxstlfS3Ekr/0QnuGUDCOcBRLWzcJo+TLrKuHDB5XvBaqqXf6DcGmJ20U8jegx0CA/8cSbtmeA4KzfgEQP4vcZyDd+aACanwnJs5YHJWXeoHAcz22t4A09rIlJkElvJjiUDldMliOHDIMglsACrIUADji5K8/hMcMJlUloefO2DyoMTkLi7SRbpf9xtgOJplFnLyyZgEXAGlv1vmx6wFHjSAM0rSGQ6YkFqrSjMHTFW0l+LZuZqrfbSPBmqguqlbCPfyS5JWSjo10Rt1xsIChkcAHFQa5PcZMjPzPNki7M4Bk+dFBzBH6Ajr9Q29oQbGQK5MBiUClQQskcGSOkvaKuSbAZjHE0ChfGyrkDk0Ibv3ZmU04IDJ8wdBHOb3+r1e02uaruk6SAdVMsLUkqMU9caSd5SbE6TLZiHfDMDAP+NIR63l/yQYAZA3dwnZhzcLqwEHTFhNhWy3Vmt1r+5VX/VVbdXWPKv4kk7+KqmDpDpJDagxhns5bJHx8oX8ON7hdZuWSBdI7jvkJLxZWg04YArwcTymx3SjbtT7el/f63vjl1UUvGPDU9gr2VayTNceRwLMgGMSR7R0PLQCKCDGXTpgCrC45MSQUPacnlNP9TTaf0Uhsk/Bi9PL/ShbwOBWpr5yqh0JL9qTkpYlCv3tLKlWAWZcPF06YAq01gBmvMZrG22Tgr38QyJhDAO9fM4+gHk0YZPsomEapsuN7p9OyNTkGJbuCEehvzdKHAlfJQAaJjZUIKXEoFsHTIEWEU5ZUzUVLGaAc7jxvwKZnSBT4kouf1wDTKNLIvl42g4xO6izOpubOrXcIgkHwa8rmQm1zYIjIAD1+2RyXXYHTK6aC/HcgTpQjdVYW2vrJG4ZHy80ftzG6agsG8iUMAfaq709nzqTE7c0lWZ2CPFGNJmQYAhg2+BJC+qghXy8yJs5YAr4AXCcYnc4RsfYB7+f9pNE8XB2EHYXbg9LJRsAww7D86QLnKWzUjTONtBJF8lctD0k7V1ALcSrawdMgdcTG4adpqu6JqgyYYx6ALOo5BqL49RA+6mf+ulrfa1e6qXN7daxZMkFMDwPpYbSTi9LalRiUzVN3BBQYIVUuft/J9zwkE2jFwdMgXXeX/11p+60Y9kMzVB9i8pzLQVX7qUTyi5NLCFVXqaGaqIxGiOq0vD7nhXuh8kVMMHYAJj7Z4jbEGTFEVGdBVuMegepXPWFf28HTIF1DFWmt3prE22iq9VTTS13JRNXbIMXraGampcNrxvETo5nG4RMTHhkmfoLM8kVkv4hid+PSoAa5rS7oZO154AJ8y1VoQ3eMmwPbJEztY0uV/uSgGLbED2WVpEJADNCI9RDPfQ/YwEEwtGNHJp8ACboE8Y0feIM4LYzdh0PegbaccCE+HSr2uRJPan7dJ9Gqalu1ZcaaBH+TFIWMLQmBfoFvaB9tW/iYfohztIlU2dZ/hxPHo6BOYniG9gL2DjZFvbIctga0NwBE8EirdAKLdCDaqCF2l8P6D29F6LYH4BZrYbqtT7w+Vv9Vp/pM7OFSgX7hY+5UHbHT4n0gaA+WjtJeNWKVxwwkaw9effj1FCddKrO1TItMzfzpma8phN4YM9oRw00Y7+FlY3FAbx3EuAADEe83SKYBQUFJyd2NI6U3LkZXH0ewfDVZIhYAGbevHmaNm2aTjrpJO2yS3WktH9tXq/eelUTNd2qY16ra3WYVemvTIZoZ/3Z0gUo3YQ0UzMz/kvLOFXVQ5bLVwjNhtRo6hVQe6C46gjEAjAff/yxOnXqpNq1a6tRo0YaODAdjSSXDyQfz2CcQ5I8UT9THe2lvSwmkzqukjzekBInwRyt0qr1TIEJmiCq05SWcdoYgOH98OJh4+Ac2F3SNjUojlO19YwFYNatW2eAefzxx7Vy5Up17969GoEGN+0TieBgE03TNP1Jf9J22s6q/VeMq5QFzLtarYGavR4wuKmxZQBMYws65tNDlu3HBHBWJZLWCCjiFNiY75Pt+2ffPhaACaZ94IEH6sEHH9R5552nK6+8Updeeqm22ipsqm/2ygv3BIFB+FuwhLfW5/pcR+pIs2Paqq3+ZjXG0sm7mlviUbteiw0g8MpwIBAMbaQDSvYoaPvdw71GJK3Y9aD+sOtABiWOk6q0bSQvU5BBYgWYYcOGqV+/fhoyZIhmzZqlOnXq6OSTT9bhhyczhQuixzKdEit5W29buaVD7KOGgrKBfv+0ntYkTdJojRYu5+PtmovUMlc9dL5m2GVN+5tHjBoxVIn5tzqax+qawk8oqxFwc5Ofg93GvLnolnoF6XhzWXW+0RvHCjBo87bbbtNjjz2me+65Rx999JFuvfVW3X777TruuOMiUTYR+aVaqpmaaYB5Ti30F32qi3XD+vx+rvej3Sf6xNzLG9zEFV9xsa5VB01SW/XQ7xL1yv4tjj/jEk6DsKnMkUw/aRCS13AOsMPyvgCGf7jqRf0ieR0vdoBZvXq1hg4dqk033VSdO3fWjBkzdN9994ndZ/PNyxMX86pLHatjhY0xVRS3QJZpZz2ta/SlGepbaav1MRUYAEfpKPs7PLF0+S7rNFIjNE6bq/X6Ome4mQFMe92Z8Fbldx757Y0gKOVtAycBveNZOza/w0TUW7UGzLHHHqvPPvtMn36a3X0rS5Ys0SWXXGLGf+PGje137Bt+32yzwkWricSXvRsGLxalXE+05QRQ7C436AadolN0qk61yjLYMvfoHu2QMqdliUapkxbrOGM8c43GWEsPGKet1Eqnh6qSGdHXFGoYwIOtgzPkvATzGBoO9JvCrU2oVwvRqFoDhvcnrvL000/ryCM5C4eXJ598UhdeeKGGDx+u3Xbbzbxol112mXr16hW+kyxbAhhuH9vDbAs4WdgaPcv08qE+1IW60Cj/5+t8M+AXa7E5AgZrsHHOysoSTVE/ddWLelbPmVdtpT7QUo3R4Rqk+XbkqYlCYPbjRPVOdEVODjE0grnoj8Bo9ZNqD5hBgwZpzpw5GjFiRNbaw5YBKIMHD7Yd5qyzztITTzwhdq5CCNH4XbWrHtbDSXdVcnNYWeHCJdzLuJVhMeMgQLBlSGsuK0u1Vg+qox7RAD2cKAw4U0PVX330nH4wt25NFo5sCxP/wDAPbjKgRkEAGHadxlJO17nnXy/VHjBz587VwQcfrJEjR6pNmzZZawAGwNlnn61Ro0ZZP6effrrefrv0A823UMSPSHzpsQwuGFT89P9Swguj/Zcl/1HoAhD9xwrxJUtpSnNnXaUJWpioczZT32mRmpS4A9iZsI/iIxzVgn8E8Lg9lXBVp6PhRBv3qfaA4UMYO3asrrrqKk2dOlUNGmQqvVrx02Gn6du3rwU2Ad78+fPtd5gBOAkWLlwogp+pBOcBR7qwDgOOTOwzI+18fnG5In2pP2vqmOE1IzYDV4xjW9nMSpgCa9RQZ2uWZqqO3rOaACerjyZrsl3gdLtu1+7aPUQt5/hAa2PMpEYAhuj9zTffbAZ7z549tc02UDGyE450Dz/8sG644QYDz0UXXaSOHTuay/nuu+9Ws2bNtOWWZbP4fvzxR02ePNnGZHfbbz9y8tMJXqBF+kw7abA6apBuy4pnxbXlf9QfDSjDNdwcARuEKjP/VUc9pS21if5mToSWWqGdtYt2McDgxoZzxp00v9Av7GjHcc8lvxqoEYBhyl999ZXOOOMMs0VwF2frBKAPdhrAcdhhh+m1114zADz77LMaPXq0jjnmmAqA+emnn2x3e+mll/T999+bA2G77bZLswKlV+6tVFfN0Z81XSvUXjeGvlRppVYaKXO+5luxjCt1pZEsSW0ujZ6P0zdqrivUWmNF/eXS+EvgmeM4h21EUJTfm6iJjc3O45I/DdQYwASg2WOPPbTjjjvah5+LTTN9+nTddNNN+uGHH/TKK69owYIFql+/fqUa/frrr81Nfeedd2rvvdNVWAnuqOymtZqsTrYb1LY6y2EFm4bi5ewOBCf54DfUZi5NKJuvAZqnBiUO6iutW4Kj0GsoxYQsSfzHn3+lXxmdhh0ofV2zsG/n7dBAjQIML0xcpmnTpvr222/tX392mkwffPJSr127Vn//+99tl2K3+PxzqqdULm+88YZ529iN0ttQFJLAQMU4JfZykpqruW7WzTrBbgcLJwCEVOQ1WmO7BVeZ44buop+rtmZrrhbpj1polzbhgj5P51nt5nSX0OJQaKVWdlktFWwmaqLZOYCRQKpLdhqocYBheni++IDJgznkkEP0hz/8QUcccYQOOuggbbJJ5nM7NhHPcxR7/vnn1aJFaXJWOgFgxG/efPPNDOAkUImUem4IUpLPf5NuKle8Iv1YxGQAAanIgOZlvazrdJ3FbQaqvlZpX7XTcKPJkCIAs4BAaKZbm+G30c93+k5f6SsrMMhuhq0EkFzCaaBGAiYATbt27cQRDYIlZEuOal27dg1FtgQwY8aMsWeuu+46XXwxHq3Ugkv61VdftXgOnrX0AmAOkLQh9kJB8qt1tf6qv4YGDTbIJbpEJ+pEczXfpts0S7M0TfeqtpqpkRpZjQCIm3jWwgAmeGeu45ijOXbZExSbbbWtWqqlLjaPnksmDdRYwDAxjmcNGzbU5ZdfrquvvtoYAddff7122mknI2GeempwDV5ZNWDM4yHr0qWLjj76aANBZXEeALNmzRpjDtSqVVnZIWgfHHM2xAyo5P+QHrKj2Ut6SfVDBuBe1+uWVUn1fwKaGO/sDPDPsEvYKWYL75l0gS4wBnNpZc3wwm72gT4w7xrJbLi2Oa65pNdAjQZMAJpDDz1Uffr0Ubdu3cz1jDesd+/eWrx4sQUsmzRpYiAKdgf+Hx//J598ohNOOMGSzdhxJk6caN6yZCFOc8cdd9jzgCxXeV7PW9lYjljESyrP5y8dhePSi3rRrjGnmPkVusI+aOI2BDr54AETH/pVuirkJbQVZ4CjIKidxm61WyQ1AnLV5MZ9rsYDBvXhIia2cuaZZ1p8JYjTcOSaNGmS0fxxR7ObtG3b1pwF/fv3t+f4f5A7idPQB0xn2ABB4hlMA2oFsAOVB1O2S8cxaIiG2NEM4iVBykwCaKDOkNbMNea4m5EpmmKZlwhG/a/165wBE7wDoBmnceZQKFswMNNbFs/PYwEYlovdgkg+Hq2WLVuWsUkADI4CALTtttvqiy++sF8wB4466qj1bGh2mLfeessAxnGNxDNoNLiTAUw+hBrJGN+UWoLSgreqMsFG4UOuq7pGmyk1/ktrFrDTXKpLzQZZqIVm02TqL9McsJdwU+NEcNBU1FZsAMPUsE1ef/11s12I4HPMSqbzc0QjpkJG5r333qvdd9/dfp6cPoAHjRjPLbfcYuBhB7rgggssdpMvAQQco7g4liMVR7TKBJBx5IIJcI7O0Wk6bT1oYAZguJOIhnu5nuol5eNk/8bYXHfoDt2qW21nC2tzZT9SzXwiVoAJloB8GGwYbBUqymB/bL31hnKnHMkAFlQZjPnjjz/e7BhSmvkFiAAbz++5556aPXu2/f98yxf6wsiXECjZNfg40xndOA24N5PkNIx8dpbgSEa0nx0BNzN/rqM65pnDpZ1rrAWbi8Q2nAmH6tBQNle+9VMd+4slYNafyXv3Nk8aOTUUxAjiNOwiZGECpnPOOcfSmTmy7bPPPjrllFO0ww476IEHHjCgbbHFFuYZw/tWOZcst+UloMiRi3/NO6iD5dKQXEZVmfJCOzxuf9FfhBeNNAL+jMv6Gl2z3obBFQ3AACK8MiL9uQhxJGwmWAS8U8WrNnLptWY/E2vAsDQcwzDkZ86caV4ygJBKAAy2CwwCdid2Gf5OnKZHjx567733jDFNTk0hBMDgJsb1jNcqFWAY91k9awwAWATYMO/qXQNOMmBoxzHun/qnHeOI51Ss/B9uFuyCOCoADFSbYpfYA4YFhnUMEPCi8TsctHTF/nAjsyvBjoapzC5z11132U5D+Sb+jrMg30LNAdzXqiPdPfpu2+1SCUe2ZLc0pE0S0YjRDNCACjWb4adRnQabhDjNv+y6jfCyTusseMpN0I/q0aK3aYoCMMmfB2Ag4xI7B24YNgq7SLqUARjKgAfeGX8mGY0jGoFSCJm51ghg53v//ffNQbH99qU3KV977bW6//779eWXVMksDcwGOUAANd1Y2BlcD/iMnlHdNXW1bNmylKxqagos0ALzqnGrWTb5MzAB2GVyPd6Fh2j1bll0gAmWg5z/8ePHW/IYhMpf/vKXtvOko74Qp4EeA8hat25tDgE8abCXs2VNc9SDwoMj4fzzz7e0hVTC0RD3N+CmTBSB01S1owEMtsY7ekdT/zHVnBSAPJUENlOQP4ObmphQJsFlDQmUYGkxS9ECJlh0XMrQ/HECkFnJR0wcp337Urp8eQEoixYtMsDwYbIzARgCpmECmxwJsYMIpGbmpskyQikVBZOhVatWuuaasoX7SFPoNbKXhs0bpjaL2uidf71jLvNM7xLkz3DUwpvGDlL2avSKc69YFaf4oFP0gAmWnA+ZowyMZD7+unWp1qiUJZ74iGmPt43AJ7tAQL2prCQU7Zo3b26AJE5UOZFzw8cYFPPgeEYyG4HUQEhX+Gn1Txpw0wC1OKGFNtt0s6zSHWA7P6EndItuMdZy2TJRZQGBowEbakPdNQdM8WmgkhkHddEACBmX+++/v3nMyv/rvXz5cqP/wxRASDXAqZCcbMZugvuaYyD9ZJIVK1bY0Y/jW3IcifSF0047TQMGDFhv+2TqK+zPOZrBZKY+Wl/1tR2ngcrWUCAm84gesbK1xZgC7TtMiK/pu+++04QJE8wAh02QLPwLD2DYbZYuXWq/AoCRnEZgNKyQqgCzINkBQcCVHQ+CaRRCpH+8xuspPWW8siDF+WAdbGnPpB7gZu6iLpZmUGzigKniigeAWbVqle1CyYAh5vPQQw9VGAFvF4ROdhDc1YHUq1fPjni5FPmo4jRSPk68h+AlDgICpewqsAgggvJ3OGdV5a4V4r0L2acDJo/axTOF6zkQwMPRimMcHi5KNcFT41iFEY87ufL8mjy+XBW6Wq7lluJM8hkBUpLi4MNRtBA3dTGJAyaL1eboBXkzEDhpZGvuuitX15UKNQYIlELc5AiXTb2BLF5lozfFhc2xjPyeYhIHTIbVDtzONMODBmETvlmQL0NNAXaQgFqDMU4AsrKU52L6wOI2VwdMmhUNApW4gkmDJrCJcIxKBkzAPYPICQuA7E7Yzy7x1IADpty6Yls8+uijFmfBTbzXXnulpM4AkHPPPdeCmAQuidwT+KS0rEt8NVD0gMHL9c0339idmBT5I6nskUce0b777ltm1QlqAg4qcHLcwiNGDQGOYy7Fo4GiBwxM5BdeeMGMc+wPcmGSBQoMMmXKFH344YeWE4NhT2wkV+Jl8Xxe8ZtpUQMmyMqEiBlE7/kz5ZoCeeaZZ4zISLyECH6jRsUXrIvfZ5/7jIoWMOSfQGch4Jjs+iV2QrQ9oJ6wixBQrAnxktw/A38yrAaKFjDYI3CysEUoNduhQ4dqE2EPu3jeLnoNFC1gole1jxgHDThg4rCKPofINOCAiUzVPlAcNOCAicMq+hwi04ADJjJV+0Bx0IADJg6r6HOITAMOmMhU7QPFQQMOmDisos8hMg04YCJTtQ8UBw04YOKwij6HyDTggIlM1T5QHDTggInDKvocItOAAyYyVftAcdCAAyYOq+hziEwDDpjIVO0DxUEDDpg4rKLPITINOGAiU7UPFAcNOGDisIo+h8g04ICJTNU+UBw04ICJwyr6HCLTgAMmMlX7QHHQgAMmDqvoc4hMAw6YyFTtA8VBAw6YOKyizyEyDThgIlO1DxQHDThg4rCKPofINOCAiUzVPlAcNOCAicMq+hwi04ADJjJV+0Bx0IADJg6r6HOITAMOmMhU7QPFQQMOmDisos8hMg04YCJTtQ8UBw04YOKwij6HyDTggIlM1T5QHDTggInDKvocItOAAyYyVftAcdCAAyYOq+hziEwDDpjIVO0DxUEDDpg4rKLPITINOGAiU7UPFAcNOGDisIo+h8g04ICJTNU+UBw04ICJwyr6HCLTgAMmMlX7QHHQgAMmDqvoc4hMAw6YyFTtA8VBAw6YOKyizyEyDThgIlO1DxQHDThg4rCKPofINOCAiUzVPlAcNOCAicMq+hwi08D/A0JEvcxuyjodAAAAAElFTkSuQmCC",
    },
  ],
}).write();

interface Project {
  id: string;
  name: string;
  strokes: Stroke[];
  image: string;
}

interface Stroke {
  point: Point[];
}

interface Point {
  x: number;
  y: number;
}

const app = express();

app.use(cors());
app.use(bodyParser.json());

const port = 4000;

app.get("/projects", (req, res) => {
  const data = db.get("projects").value();
  const projects = data.map((project) => ({
    name: project.name,
    image: project.image,
    id: project.id,
  }));
  return res.json(projects);
});

app.post("/projects/new", (req, res) => {
  db.get("projects")
    .push({ ...req.body, id: nanoid() })
    .write();
  res.json({ success: true });
});

app.get("/projects/:projectId", (req, res) => {
  const { projectId } = req.params;
  const project = db.get("projects").find({ id: projectId }).value();

  if (project) {
    return res.json({
      success: true,
      project,
    });
  } else {
    return res.json({
      success: false,
    });
  }
});

app.listen(port, () =>
  console.log(`Backend running on http://localhost:${port}!`)
);
